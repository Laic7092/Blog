---
title: 复刻植物大战僵尸-part0
date: 2024-01-03 21:40
tags:
- game
- pvz
location: 长沙天心区新姚南路
---

虽然俄罗斯方块的还没写完(差好多但是我不想写啊啊啊)，很久之前就做了的东西，现来写感觉好难受，当然也是因为我对于浏览器中涉及的概念原理不太熟悉。之前也是边学边做的，简称就是半吊子哈哈哈哈。

`pvz`，我相信绝大多数`00后`都有玩过，这真的是我的童年启蒙游戏之一(不包括4399小游戏哈哈哈)，这个新坑也是绝对的新，因为我没有半点准备，就决定先记录一下这件事。然后这篇作为第一天也是照例写一下制作思路。

这里先说明一下，这次我不打算完全不借助任何工具，我会用到`PIXI.js`作为渲染引擎，然后`matter.js`作为物理引擎(这个不一定，因为pvz中涉及到的物理很少，可能会手写)。为什么要用工具?首要原因还是完全靠手写制作时间会太长，在`pvz`之后我想先写一个mini版的游戏框架，会附带渲染和物理系统(当然会很简陋，这个我目前有做一些，但是还有待完善。。。)

---

## 粗略构思

1. 我眼里的`pvz`，大概算一个`闯关加塔防`游戏，所以如何用正确的数据结构表示一个关卡，以及在后续开发中能够在简单的几步操作下(例如JSON?)制作一个新的关卡极为重要。目前我考虑的最常规的模式

   1. 关卡前的对话，事件，或者其他啥东西要展示的
   2. 僵尸展示，生成地图和选择植物
   3. 种植物，生成僵尸
   4. 关卡完成后的奖励界面或者其他重要事件

2. 还是老生常谈的交互问题，`pvz`基本都是鼠标操作。除了一个，最开始进游戏的时候的输入Id需要键盘来着，但我想先忽略这个。然后值得注意的是`PIXI.js`内部有集成鼠标事件，可以考虑直接用那个省时间。

3. 游戏UI也是一个值得说的问题，游戏主界面如下
   ![image-20240103222319381](https://s2.loli.net/2024/01/03/1yMDFuxLXteRaWJ.png)
   主要是菜单以及顶部的植物栏和工具栏这么看也不是很难哈哈哈。但是还有其他的UI要弄，必须注意如何快速的构建UI，分离UI层和主面板，控制好UI的显示逻辑等等，这么看又不是很容易555555(还有游戏图鉴啊，我居然忘了，植物图鉴，僵尸图鉴，这都是活生生的内容啊)。

4. `PIXI.js`可以很方便的解决渲染，动画的问题，但是音效是我的未知领域，如何处理还有待学习。还有一点很麻烦的就是游戏素材，这个可能只好在网上找找了，应该会有贴图和音效。

5. 游戏存档问题，由于浏览器内部限制，js不能直接访问本地文件系统。目前考虑使用`JSON`格式导出数据，下面是一个简单的实现

   ```javascript
   // 假设obj就是我们的游戏数据
   const obj = { hello: "world" }
   const blob = new Blob([JSON.stringify(obj, null, 2)], {
     type: "application/json",
   })
   
   // 创建一个a标签，触发点击事件，下载JSON文件
   const a = document.createElement('a')
   a.href = URL.createObjectURL(blob)
   a.download = 'pvzData.json'
   a.click()
   ```

   然后导入游戏数据就是通过`<input type="file" />`标签导入本地存档，目前来看这个思路没问题。

## 进一步构思

首先确认一下，这个月的时间想要达到怎样的一个效果，因为我的时间是有限的。。。除了整个游戏框架的构建，剩下的内容填充有几个部分

1. 植物的制作和僵尸的制作，包括技能
2. 游戏的附加内容，禅意花园，冒险模式，无尽模式，小游戏。。。这些可能时间去弄
3. 能否附带一点创新?例如把第二代的欢乐豆和金手指抄进来哈哈哈哈
4. 如果能够附加上联机功能?我暂时想法是，参考大部分独立游戏设立的每日挑战(或者每周挑战)，玩家的损伤程度，闯关速度，总体话费等等作为评分手段，然后会有一个公开的排行榜。扯远了一些，除非我马上离职全职开发哈哈哈，不然根本不够。

上面提到的，这短期是不可能完成的，全部排除。确认下来就是

1. 包含简陋的UI界面
2. 只有标准关卡游戏流程
3. 包含几个基本的植物和僵尸
4. 只做部分关卡

## 小结

这篇文章花了1h，明天下班后可能会先思考整个游戏关卡的数据结构，之后是植物和僵尸的数据结构，然后就是简单的UI和交互，短期内先实现一个pvz第一关

ps: 不出意外可能会鸽子，或者说肯定会哈哈哈。